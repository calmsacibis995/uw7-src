/*
 *	@(#)disassemble.c	11.1	10/22/97	11:58:54
 */
/*
 *	disassemble.c - created from interp.h to allow symbolic
 *		display of opcodes
 */
struct OpCodes {
	char * symbol;
	unsigned char opcode;
};

static struct OpCodes OPCODES[] = {
"ADDB",	0x00,
"ADD",	0x01,
"ADDB|2",	0x02,
"ADD|2",	0x03,
"ADD_AL",	0x04,
"ADD_AX",	0x05,
"PUSHES",	0x06,
"POPES",	0x07,
"ORB",	0x08,
"OR",	0x09,
"ORB|2",	0x0A,
"OR|2",	0x0B,
"OR_IMMAL",	0x0C,
"OR_IMMAX",	0x0D,
"PUSHCS",	0x0E,
"ENH 386",	0x0F,
"ADCB",	0x10,
"ADC",	0x11,
"ADCB|2",	0x12,
"ADC|2",	0x13,
"ADC_AL",	0x14,
"ADC_AX",	0x15,
"PUSHSS",	0x16,
"POPSS",	0x17,
"SBBB",	0x18,
"SBB",	0x19,
"SBBB|2",	0x1A,
"SBB|2",	0x1B,
"SBB AL,imm",	0x1C,
"SBB eAX,imm",	0x1D,
"PUSHDS",	0x1E,
"POPDS",	0x1F,
"ANDB",	0x20,
"AND",	0x21,
"ANDB|2",	0x22,
"AND|2",	0x23,
"AND_AL",	0x24,
"AND_AX",	0x25,
"SEGOVRES",	0x26,
"DAA",	0x27,
"SUBB",	0x28,
"SUB",	0x29,
"SUBB|2",	0x2A,
"SUB|2",	0x2B,
"SUB_AL",	0x2C,
"SUB_AX",	0x2D,
"SEGOVRCS",	0x2E,
"DAS",	0x2F,
"XORB",	0x30,
"XOR",	0x31,
"XORB|2",	0x32,
"XOR|2",	0x33,
"XOR_IMMAL",	0x34,
"XOR_IMMAX",	0x35,
"SEGOVRSS",	0x36,
"AAA",	0x37,
"CMPB",	0x38,
"CMP",	0x39,
"CMPB|2",	0x3A,
"CMP|2",	0x3B,
"CMP_AL",	0x3C,
"CMP_AX",	0x3D,
"SEGOVRDS",	0x3E,
"AAS",	0x3F,
"INC_AX",	0x40,
"INC_CX",	0x41,
"INC_DX",	0x42,
"INC_BX",	0x43,
"INC_SP",	0x44,
"INC_BP",	0x45,
"INC_SI",	0x46,
"INC_DI",	0x47,
"DEC_AX",	0x48,
"DEC_CX",	0x49,
"DEC_DX",	0x4A,
"DEC_BX",	0x4B,
"DEC_SP",	0x4C,
"DEC_BP",	0x4D,
"DEC_SI",	0x4E,
"DEC_DI",	0x4F,
"PUSHAX",	0x50,
"PUSHCX",	0x51,
"PUSHDX",	0x52,
"PUSHBX",	0x53,
"PUSHSP",	0x54,
"PUSHBP",	0x55,
"PUSHSI",	0x56,
"PUSHDI",	0x57,
"POPAX",	0x58,
"POPCX",	0x59,
"POPDX",	0x5A,
"POPBX",	0x5B,
"POPSP",	0x5C,
"POPBP",	0x5D,
"POPSI",	0x5E,
"POPDI",	0x5F,
"PUSHALL",	0x60,
"POPALL",	0x61,
"BOUND",	0x62,
"nocode",	0x63,
"nocode",	0x64,
"nocode",	0x65,
"OPSIZE",	0x66,
"ADDRSZ",	0x67,
"PUSH_Iw",	0x68,
"nocode",	0x69,
"PUSH_Ib",	0x6A,
"nocode",	0x6B,
"nocode",	0x6C,
"nocode",	0x6D,
"nocode",	0x6E,
"nocode",	0x6F,
"JO",	0x70,
"JNO",	0x71,
"JB",	0x72,
"JAE",	0x73,
"JE",	0x74,
"JNE",	0x75,
"JBE",	0x76,
"JA",	0x77,
"JS",	0x78,
"JNS",	0x79,
"JP",	0x7A,
"JNP",	0x7B,
"JL",	0x7C,
"JGE",	0x7D,
"JLE",	0x7E,
"JG",	0x7F,
"Imm1 Eb,Ib",	0x80,
"Imm1 Ev,Iv",	0x81,
"nocode",	0x82,
"Imm1 Ev,Ib",	0x83,
"TEST Eb,Gb",	0x84,
"TEST Ev,Gv",	0x85,
"XCHG Eb,Gb",	0x86,
"XCHG Ev,Gv",	0x87,
"MOVB MOVR2_R1B",	0x88,
"MOV MOVR2_R1W",	0x89,
"MOVR1_R2B",	0x8A,
"MOVR1_R2W",	0x8B,
"MOVSEG_REG",	0x8C,
"LEA",	0x8D,
"MOVREG_SEG",	0x8E,
"OUTSW/D",	0x8F,
"NOP",	0x90,
"XCHGCX",	0x91,
"XCHGDX",	0x92,
"XCHGBX",	0x93,
"XCHGSP",	0x94,
"XCHGBP",	0x95,
"XCHGSI",	0x96,
"XCHGDI",	0x97,
"CBW",	0x98,
"CWD",	0x99,
"CALL_FAR",	0x9A,
"WAIT",	0x9B,
"PUSHFL",	0x9C,
"POPFL",	0x9D,
"SAHF",	0x9E,
"LAHF",	0x9F,
"MOVAL_MEM",	0xA0,
"MOVAX_MEM",	0xA1,
"MOVMEM_AL",	0xA2,
"MOVMEM_AX",	0xA3,
"MOVSB",	0xA4,
"MOVSW",	0xA5,
"CMPSB",	0xA6,
"CMPSW",	0xA7,
"TEST_AL",	0xA8,
"TEST_AX",	0xA9,
"STOSB",	0xAA,
"STOSW",	0xAB,
"LODSB",	0xAC,
"LODSW",	0xAD,
"SCASB",	0xAE,
"SCASW",	0xAF,
"MOVAL_IM",	0xB0,
"MOVCL_IM",	0xB1,
"MOVDL_IM",	0xB2,
"MOVBL_IM",	0xB3,
"MOVAH_IM",	0xB4,
"MOVCH_IM",	0xB5,
"MOVDH_IM",	0xB6,
"MOVBH_IM",	0xB7,
"MOVAX_IM",	0xB8,
"MOVCX_IM",	0xB9,
"MOVDX_IM",	0xBA,
"MOVBX_IM",	0xBB,
"MOVSP_IM",	0xBC,
"MOVBP_IM",	0xBD,
"MOVSI_IM",	0xBE,
"MOVDI_IM",	0xBF,
"AX_AX AX_ES",	0xC0,
"Shft2 Ev,Ib",	0xC1,
"RET_DISP",	0xC2,
"RET",	0xC3,
"LES",	0xC4,
"LDS",	0xC5,
"MOV Eb,Ib",	0xC6,
"MOV Ev,Iv",	0xC7,
"AX_CS AX_CX ENTER",	0xC8,
"LEAVE",	0xC9,
"RETF_DISP",	0xCA,
"RETF",	0xCB,
"INT3",	0xCC,
"INTX",	0xCD,
"INT0",	0xCE,
"IRET",	0xCF,
"AX_DX AX_SS",	0xD0,
"Shft2 Ev,1",	0xD1,
"Shft2 Eb,CL",	0xD2,
"Shft2 Ev,CL",	0xD3,
"AAM",	0xD4,
"AAD",	0xD5,
"nocode",	0xD6,
"XLAT",	0xD7,
"AX_BX AX_DS ESC0",	0xD8,
"ESC1",	0xD9,
"ESC2",	0xDA,
"ESC3",	0xDB,
"ESC4",	0xDC,
"ESC5",	0xDD,
"ESC6",	0xDE,
"ESC7",	0xDF,
"AX_SP LOOPNZ",	0xE0,
"LOOPZ",	0xE1,
"LOOP",	0xE2,
"JCXZ",	0xE3,
"INB",	0xE4,
"INW",	0xE5,
"OUTAL",	0xE6,
"OUTAX",	0xE7,
"AX_BP CALL",	0xE8,
"JMPREL",	0xE9,
"JMPFAR",	0xEA,
"JMPSHORT",	0xEB,
"INB_DX",	0xEC,
"INW_DX",	0xED,
"OUTDX_AL",	0xEE,
"OUTDX_AX",	0xEF,
"AX_SI LOCK",	0xF0,
"nocode",	0xF1,
"REPNZ",	0xF2,
"REPZ",	0xF3,
"HLT",	0xF4,
"CMC",	0xF5,
"Unary3 Eb",	0xF6,
"Unary3 Ev",	0xF7,
"AX_DI CLC",	0xF8,
"STC",	0xF9,
"CLI",	0xFA,
"STI",	0xFB,
"CLD",	0xFC,
"STD",	0xFD,
"INC/DEC 4",	0xFE,
"Indirect 5",	0xFF,
};

static struct OpCodes OPCODES_386[] = {
"ENH 386 Grp6",	0x00,
"ENH 386 Grp7",	0x01,
"ENH 386 LAR Gv,Ew",	0x02,
"ENH 386 LSL Gv,Ew",	0x03,
"ENH 386 nocode",	0x04,
"ENH 386 nocode",	0x05,
"ENH 386 CLTS",	0x06,
"ENH 386 nocode",	0x07,
"ENH 386 INVD",	0x08,
"ENH 386 WBINVD",	0x09,
"ENH 386 nocode",	0x0A,
"ENH 386 nocode",	0x0B,
"ENH 386 nocode",	0x0C,
"ENH 386 nocode",	0x0D,
"ENH 386 nocode",	0x0E,
"ENH 386 nocode",	0x0F,
"ENH 386 nocode",	0x10,
"ENH 386 nocode",	0x11,
"ENH 386 nocode",	0x12,
"ENH 386 nocode",	0x13,
"ENH 386 nocode",	0x14,
"ENH 386 nocode",	0x15,
"ENH 386 nocode",	0x16,
"ENH 386 nocode",	0x17,
"ENH 386 nocode",	0x18,
"ENH 386 nocode",	0x19,
"ENH 386 nocode",	0x1A,
"ENH 386 nocode",	0x1B,
"ENH 386 nocode",	0x1C,
"ENH 386 nocode",	0x1D,
"ENH 386 nocode",	0x1E,
"ENH 386 nocode",	0x1F,
"ENH 386 MOV Cd,Rd",	0x20,
"ENH 386 MOV Dd,Rd",	0x21,
"ENH 386 MOV Rd,Cd",	0x22,
"ENH 386 MOV Rd,Dd",	0x23,
"ENH 386 MOV Td,Rd",	0x24,
"ENH 386 nocode",	0x25,
"ENH 386 MOV Rd,Td",	0x26,
"ENH 386 nocode",	0x27,
"ENH 386 nocode",	0x28,
"ENH 386 nocode",	0x29,
"ENH 386 nocode",	0x2A,
"ENH 386 nocode",	0x2B,
"ENH 386 nocode",	0x2C,
"ENH 386 nocode",	0x2D,
"ENH 386 nocode",	0x2E,
"ENH 386 nocode",	0x2F,
"ENH 386 nocode",	0x30,
"ENH 386 nocode",	0x31,
"ENH 386 nocode",	0x32,
"ENH 386 nocode",	0x33,
"ENH 386 nocode",	0x34,
"ENH 386 nocode",	0x35,
"ENH 386 nocode",	0x36,
"ENH 386 nocode",	0x37,
"ENH 386 nocode",	0x38,
"ENH 386 nocode",	0x39,
"ENH 386 nocode",	0x3A,
"ENH 386 nocode",	0x3B,
"ENH 386 nocode",	0x3C,
"ENH 386 nocode",	0x3D,
"ENH 386 nocode",	0x3E,
"ENH 386 nocode",	0x3F,
"ENH 386 nocode",	0x40,
"ENH 386 nocode",	0x41,
"ENH 386 nocode",	0x42,
"ENH 386 nocode",	0x43,
"ENH 386 nocode",	0x44,
"ENH 386 nocode",	0x45,
"ENH 386 nocode",	0x46,
"ENH 386 nocode",	0x47,
"ENH 386 nocode",	0x48,
"ENH 386 nocode",	0x49,
"ENH 386 nocode",	0x4A,
"ENH 386 nocode",	0x4B,
"ENH 386 nocode",	0x4C,
"ENH 386 nocode",	0x4D,
"ENH 386 nocode",	0x4E,
"ENH 386 nocode",	0x4F,
"ENH 386 nocode",	0x50,
"ENH 386 nocode",	0x51,
"ENH 386 nocode",	0x52,
"ENH 386 nocode",	0x53,
"ENH 386 nocode",	0x54,
"ENH 386 nocode",	0x55,
"ENH 386 nocode",	0x56,
"ENH 386 nocode",	0x57,
"ENH 386 nocode",	0x58,
"ENH 386 nocode",	0x59,
"ENH 386 nocode",	0x5A,
"ENH 386 nocode",	0x5B,
"ENH 386 nocode",	0x5C,
"ENH 386 nocode",	0x5D,
"ENH 386 nocode",	0x5E,
"ENH 386 nocode",	0x5F,
"ENH 386 nocode",	0x60,
"ENH 386 nocode",	0x61,
"ENH 386 nocode",	0x62,
"ENH 386 nocode",	0x63,
"ENH 386 nocode",	0x64,
"ENH 386 nocode",	0x65,
"ENH 386 nocode",	0x66,
"ENH 386 nocode",	0x67,
"ENH 386 nocode",	0x68,
"ENH 386 nocode",	0x69,
"ENH 386 nocode",	0x6A,
"ENH 386 nocode",	0x6B,
"ENH 386 nocode",	0x6C,
"ENH 386 nocode",	0x6D,
"ENH 386 nocode",	0x6E,
"ENH 386 nocode",	0x6F,
"ENH 386 nocode",	0x70,
"ENH 386 nocode",	0x71,
"ENH 386 nocode",	0x72,
"ENH 386 nocode",	0x73,
"ENH 386 nocode",	0x74,
"ENH 386 nocode",	0x75,
"ENH 386 nocode",	0x76,
"ENH 386 nocode",	0x77,
"ENH 386 nocode",	0x78,
"ENH 386 nocode",	0x79,
"ENH 386 nocode",	0x7A,
"ENH 386 nocode",	0x7B,
"ENH 386 nocode",	0x7C,
"ENH 386 nocode",	0x7D,
"ENH 386 nocode",	0x7E,
"ENH 386 nocode",	0x7F,
"ENH 386 JO",	0x80,
"ENH 386 JNO",	0x81,
"ENH 386 JB",	0x82,
"ENH 386 JNB",	0x83,
"ENH 386 JZ",	0x84,
"ENH 386 JNZ",	0x85,
"ENH 386 JBE",	0x86,
"ENH 386 JNBE",	0x87,
"ENH 386 JS",	0x88,
"ENH 386 JNS",	0x89,
"ENH 386 JP",	0x8A,
"ENH 386 JNP",	0x8B,
"ENH 386 JL",	0x8C,
"ENH 386 JNL",	0x8D,
"ENH 386 JLE",	0x8E,
"ENH 386 JNLE",	0x8F,
"ENH 386 SETO",	0x90,
"ENH 386 SETNO",	0x91,
"ENH 386 SETB",	0x92,
"ENH 386 SETNB",	0x93,
"ENH 386 SETZ",	0x94,
"ENH 386 SETNZ",	0x95,
"ENH 386 SETBE",	0x96,
"ENH 386 SETNBE",	0x97,
"ENH 386 SETS",	0x98,
"ENH 386 SETNS",	0x99,
"ENH 386 SETP",	0x9A,
"ENH 386 SETNP",	0x9B,
"ENH 386 SETL",	0x9C,
"ENH 386 SETNL",	0x9D,
"ENH 386 SETLE",	0x9E,
"ENH 386 SETNLE",	0x9F,
"ENH 386 PUSH FS",	0xA0,
"ENH 386 POP FS",	0xA1,
"ENH 386 nocode",	0xA2,
"ENH 386 BT Ev,Gv",	0xA3,
"ENH 386 SHLD EvGvIb",	0xA4,
"ENH 386 SHLD EvGvCL",	0xA5,
"ENH 386 CMPXCHG Eb,Gb",	0xA6,
"ENH 386 CMPXCHG Ev,Gv",	0xA7,
"ENH 386 PUSH GS",	0xA8,
"ENH 386 POP GS",	0xA9,
"ENH 386 nocode",	0xAA,
"ENH 386 BTS Ev, Gv",	0xAB,
"ENH 386 SHRD EvGvIb",	0xAC,
"ENH 386 SHRD EvGvCL",	0xAD,
"ENH 386 nocode",	0xAE,
"ENH 386 IMUL Gv,Ev",	0xAF,
"ENH 386 nocode",	0xB0,
"ENH 386 nocode",	0xB1,
"ENH 386 LSS Mp",	0xB2,
"ENH 386 BTR Ev,Gv",	0xB3,
"ENH 386 LFS Mp",	0xB4,
"ENH 386 LGS Mp",	0xB5,
"ENH 386 MOVZX Gv,Eb",	0xB6,
"ENH 386 MOVZX Gv,Ew",	0xB7,
"ENH 386 nocode",	0xB8,
"ENH 386 nocode",	0xB9,
"ENH 386 Grp-8 Ev,Ib",	0xBA,
"ENH 386 BTC Ev,Gv",	0xBB,
"ENH 386 BSF Gv,Ev",	0xBC,
"ENH 386 BSR Gv,Ev",	0xBD,
"ENH 386 MOVSX Gv,Eb",	0xBE,
"ENH 386 MOVSX Gv,Ew",	0xBF,
"ENH 386 XADD Eb,Gb",	0xC0,
"ENH 386 XADD Ev,Gv",	0xC1,
"ENH 386 nocode",	0xC2,
"ENH 386 nocode",	0xC3,
"ENH 386 nocode",	0xC4,
"ENH 386 nocode",	0xC5,
"ENH 386 nocode",	0xC6,
"ENH 386 nocode",	0xC7,
"ENH 386 BSWAP EAX",	0xC8,
"ENH 386 BSWAP ECX",	0xC9,
"ENH 386 BSWAP EDX",	0xCA,
"ENH 386 BSWAP EBX",	0xCB,
"ENH 386 BSWAP ESP",	0xCC,
"ENH 386 BSWAP EBP",	0xCD,
"ENH 386 BSWAP ESI",	0xCE,
"ENH 386 BSWAP EDI",	0xCF,
"ENH 386 nocode",	0xD0,
"ENH 386 nocode",	0xD1,
"ENH 386 nocode",	0xD2,
"ENH 386 nocode",	0xD3,
"ENH 386 nocode",	0xD4,
"ENH 386 nocode",	0xD5,
"ENH 386 nocode",	0xD6,
"ENH 386 nocode",	0xD7,
"ENH 386 nocode",	0xD8,
"ENH 386 nocode",	0xD9,
"ENH 386 nocode",	0xDA,
"ENH 386 nocode",	0xDB,
"ENH 386 nocode",	0xDC,
"ENH 386 nocode",	0xDD,
"ENH 386 nocode",	0xDE,
"ENH 386 nocode",	0xDF,
"ENH 386 nocode",	0xE0,
"ENH 386 nocode",	0xE1,
"ENH 386 nocode",	0xE2,
"ENH 386 nocode",	0xE3,
"ENH 386 nocode",	0xE4,
"ENH 386 nocode",	0xE5,
"ENH 386 nocode",	0xE6,
"ENH 386 nocode",	0xE7,
"ENH 386 nocode",	0xE8,
"ENH 386 nocode",	0xE9,
"ENH 386 nocode",	0xEA,
"ENH 386 nocode",	0xEB,
"ENH 386 nocode",	0xEC,
"ENH 386 nocode",	0xED,
"ENH 386 nocode",	0xEE,
"ENH 386 nocode",	0xEF,
"ENH 386 nocode",	0xF0,
"ENH 386 nocode",	0xF1,
"ENH 386 nocode",	0xF2,
"ENH 386 nocode",	0xF3,
"ENH 386 nocode",	0xF4,
"ENH 386 nocode",	0xF5,
"ENH 386 nocode",	0xF6,
"ENH 386 nocode",	0xF7,
"ENH 386 nocode",	0xF8,
"ENH 386 nocode",	0xF9,
"ENH 386 nocode",	0xFA,
"ENH 386 nocode",	0xFB,
"ENH 386 nocode",	0xFC,
"ENH 386 nocode",	0xFD,
"ENH 386 nocode",	0xFE,
"ENH 386 nocode",	0xFF,
};

static char OutputString[] = "0x00 0x00 0x00 0x00 0x00 0x00 <string no longer than this certainly>";

char *
Disassemble( ip )
unsigned char * ip;
{
	if ( 0x0f == *ip ) {
		sprintf( OutputString, "%#04x %#04x %#04x %#04x %#04x %#04x %s",
			*ip, *(ip+1), *(ip+2), *(ip+3), *(ip+4), *(ip+5),
			OPCODES_386[(*(ip+1))&0xff].symbol );
	} else {
		sprintf( OutputString, "%#04x %#04x %#04x %#04x %#04x %#04x %s",
			*ip, *(ip+1), *(ip+2), *(ip+3), *(ip+4), *(ip+5),
			OPCODES[(*ip)&0xff].symbol );
	}
	return OutputString;
}

